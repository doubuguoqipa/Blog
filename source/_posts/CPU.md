---
title: CPU卡介绍
categories:
  - 一卡通
tags:
  - Ipass
date: 2019-04-25 09:24:20
---

### CPU卡的制卡过程

---



#### CPU卡的生命周期

一张卡从制造出来到销毁的整个过程成为生命周期。IC卡的生命周期一般可分为：
1.芯片制造：IC卡厂家通过特定的制造工艺在硅片上整齐地排列上一个个电路。 
2.模块封装：将许多各种芯片安装在已制造好的有8个触点的印刷电路板上。 
3.卡片制造：将卡的操作系统等卡片控制系统掩模到模块中。

------

设计开发COS系统、芯片厂商写入芯片ROM区、EEPROM中写入制造商代号、写入IC卡的传输密钥

------

4.卡片封装：将掩模好的模块镶嵌到塑料基片中。 

------

- 此刻卡片称为“白卡”，卡片状态称为“系统状态”，ROM中的COS无效。
- 白卡通过销售交付到卡片发行商手中，发行商需对IC卡进行传输密钥解禁（系统状态进入用户状态，卡片完全受COS控制）和初始化工作才能投入实际应用。

------

5.卡片初始化：设置卡片的基本参数。 

------

- 卡片发行商在解禁后的卡片中建立文件系统，写入卡片保护的密钥等。

------

6.安装发行密钥：将发行单位的密钥写到卡上。 
7.卡片个人化：建立应用文件并写入持卡人基本资料。 

------

应用运营商根据应用的情况在卡内建立相应的文件结构，通常为一个DF下其子EF的创建。

------

8.卡片应用：持卡人用卡完成各种卡的功能。

------

卡片数据读写、卡片的认证、持卡人的认证、卡片的锁定和解锁等

------

9.应用的销毁：终止卡片的使用、终止对应的DF来终止某一应用的使用

10.卡片的二次回收利用：洗卡二次发行白卡。



#### CPU卡的目录文件

CPU卡一般最多支持三层目录，2层也够用。
CPU卡创建一个文件时必须先声明创建文件的类型和空间大小。创建完一个文件后不可以删除，
CPU卡文件类型只有很少几种，没有后缀名。
CPU卡创建文件，写文件必须通过向卡片发送APDU报文的方式进行，且每次写的字节数不能超过256字节。



#### CPU卡的文件类型

MF(master file) 根目录
不同卡片厂商的MF的创建方式是不同的。主要有两种方式：
 1、在卡片个人化过程中由发卡方创建。如明华、德生卡片 
2、厂商提供卡片的时候已经创建，发卡方不能再创建。如握奇卡片
DF（dedicated file）专用文件
DDF和ADF： 我们把包含下级目录的DF称之为DDF，不包含下级目录的称之为ADF。
注意：DDF下可以有ADF，ADF下不能再有ADF。
基本文件(EF--ElementaryFile)
交易文件 这一类的文件为特定格式的文件，通过具体的交易指令对这类文件进行操作。
如： 1、电子存折文件2、电子钱包文件



#### CPU卡的安全

CPU卡可以用用户密码加上卡上密钥的方法实现。可以设计成两种模式：方式1、在密钥认证成功后，密码才可以使用。 方式2、在密码的验证成功后，密钥才可以被使用。
这必须按顺序来，如方式一，你要是想先验证密码，对不起，卡片会给你一个提示：安全状态不满足。
这时候，你必须做的工作是，现对密钥进行认证，密钥认证成功后，再验证密码就不会提示安全状态不满足了



#### CPU卡的应用

通过创建多个ADF(即创建多个目录)达到。 每个ADF代表一个应用。每个ADF下有相应的文件，
相应的文件中存放相应的数据。
卡片
-MF （主控秘钥）
--秘钥文件
--EF1
--ADF1	--EF1
      		  --EF2
      		  --秘钥文件
--ADF2
--ADF3



#### CPU卡的文件操作

在CPU卡中，我们怎么对一个文件(比如说EF1)进行操作呢？
我们要对一个文件操作，首先，我们必须先找到要操作的那个文件，CPU卡中的文件通过文件标识表标记一个文件。
对MF和DF有关目录的文件有它们的文件名，其它文件则没有文件名。<文件标识符与文件名称> 文件标识符是文件的标识代码，用2个字节表示，为什么只有2个字节呢？因为2个字节足矣，2个字节FFFF=65535。 在选择文件时只要找出该文件的标识，就可以找到该文件。同一目录下的文件标识符是唯一的。MF的文件标识符为3F00，文件名自定义，符合银行规范名称应该是1PAY.SYS.DDF01，当然了，社保的卡规定的就不是这个名字了。
所有文件可以通过文件标识符用SELECT命令进行选择，目录文件DF可以通过目录名称进行选择。短文件标识符